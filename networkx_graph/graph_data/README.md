# Graph Data

This directory stores the generated graph data files, intermediate outputs from the creation process, and cached API data.

## Purpose

To centralize all data artifacts related to the London transport network graph.

## Key Files & Directories

*   **`networkx_graph_new.json`**: 
    *   **Description**: The primary output, created by running `../Create_graph/build_networkx_graph_new.py`. This is a NetworkX MultiDiGraph representing the London transport network. Contains station nodes and connection edges. Edges representing line segments initially have `weight=null` and transfer edges have `weight=0`. After running the relevent scripts mentioned in `../Create_graph/`, this file contains the final weighted graph used for initial pathfinding.
    *   **Structure**: JSON format compatible with `networkx.readwrite.json_graph.node_link_data`.
        *   `nodes`: Dictionary mapping station names to attribute dictionaries (id, name, lat, lon, zone, modes, lines, child_stations).
        *   `edges`: List of edge attribute dictionaries (source, target, line, line_name, mode, weight, transfer, direction, branch, key).
    *   **Generated By**: `../Create_graph/build_networkx_graph_new.py` (initial structure), optimised using the scripts in `../Create_graph/`.

*   **`Edge_weights_tube_dlr.json`**: 
    *   **Description**: Contains calculated edge weights (average journey durations between adjacent stations in minutes) for Tube and DLR lines. Derived from processing timetable data (`../Create_graph/process_timetable_data.py`) and supplemented with Journey API calls for specific missing edges (`../Create_graph/get_missing_journey_times.py`).
    *   **Format**: JSON list of objects, each representing a directional edge with attributes like `source`, `target`, `line`, `mode`, `duration_minutes`, `calculated_timestamp`.

*   **`Edge_weights_overground_elizabeth.json`**: 
    *   **Description**: Contains calculated edge weights (average journey durations between adjacent stations in minutes) specifically for Overground and Elizabeth line services. Derived using the TfL Journey Results API (`../Create_graph/get_journey_times.py`) as currently no timetable exists for these services on TFL API.
    *   **Format**: JSON list of objects, similar structure to `Edge_weights_tube_dlr.json`.

*   **`terminal_stations.json`**: 
    *   **Description**: Intermediate file listing potential terminal station Naptan IDs for Tube/DLR lines, required parameter for TFL API when fetching timetable data. The majority of terminal stations found using script below, but due to quirks of real life tube sequences (eg circle line) some manual additions were made for optimisation. 
    *   **Generated By**: `../Create_graph/find_terminal_stations.py` + manual additions.

*   **`line_edges.json`**: 
    *   **Description**: Lists unique adjacent station pairs per line extracted from the base graph. It used by scripts to generate the existing edges in our graph. This is done to validate we haven't missed any edges when extracting real edge weightings. Used as input for `get_journey_times.py`.
    *   **Generated By**: `../analyse_graph/extract_line_edges.py`.

*   **`timetable_cache/`**: 
    *   **Description**: Directory containing cached raw timetable data for majority of tube and DLR, fetched from the TfL API (`../Create_graph/get_timetable_data.py`). Contains one JSON file per line (e.g., `bakerloo.json`). Used as input in `../Create_graph/process_timetable_data.py` to calculate times between stations. It noticeably had some missing portions like earl's court -> Kensington Olympia (district line), these edges were gathered seperately using (`../Create_graph/get_missing_journey_times.py`).

*   **`legacy_data/`**: 
    *   **Description**: Subdirectory containing outdated or superseded data files. See `legacy_data/README.md` for details.

## MultiDiGraph Structure Details

The graph (`networkx_graph_new.json`) uses NetworkX's `MultiDiGraph` to accurately represent the network:

*   **Multiple Edges**: Allows multiple lines (edges) to connect the same two stations (nodes).
*   **Line-Specific Attributes**: Each edge stores crucial attributes:
    *   `line`: TfL line ID (e.g., "district", "circle") - Used for pathfinding transfer detection, as a penalty (5 minutes) will be added for this in pathfinding.
    *   `line_name`: Official line name (e.g., "District Line").
    *   `mode`: Transport mode (e.g., "tube", "elizabeth-line").
    *   `direction`: Travel direction ("inbound", "outbound").
    *   `weight`: Journey time in minutes (null initially, populated later).
    *   `transfer`: Boolean flag (`true` for walking transfers within a station complex, `false` for line travel).
    *   `key`: Unique edge identifier within the MultiDiGraph context.
*   **Transfer Handling**: Edges with `transfer: true` represent intra-station transfers. `update_transfers_in_graph.py` sets their weight to a standard penalty (e.g., 5 minutes). 