# Network Data System

This directory contains the core data files for the London transport network graph used in the Meeting Point Finder. The graph is built directly from TFL's API data, providing accurate station relationships and connections.

## Files Overview

- **networkx_graph.json**: The main graph file containing all stations (nodes) and connections (edges) in the London transport network. This includes tube, DLR, overground, and Elizabeth line services.
- **stations_slim_format.json**: A simplified version of station data compatible with the slim_stations format used in other parts of the application.
- **tfl_line_data.json**: Raw line sequence data from the TFL API used to build the graph.

## Graph Structure

The `networkx_graph.json` file contains a directed graph with:

1. **Nodes**: Stations in the network with attributes:
   - `id`: Station ID from TFL
   - `name`: Human-readable station name
   - `lat` & `lon`: Geographic coordinates
   - `zone`: London transport zone
   - `modes`: Transport modes serving this station (tube, dlr, etc.)
   - `lines`: Lines connecting to this station
   - `child_stations`: Child stations connected with zero-weight edges

2. **Edges**: Connections between stations with attributes:
   - `source` & `target`: Names of connected stations
   - `line`: Line ID connecting the stations (e.g., "bakerloo")
   - `line_name`: Human-readable line name
   - `mode`: Transport mode (tube, dlr, overground, etc.)
   - `weight`: Travel time weight (1 for normal connections, 0 for transfers)
   - `transfer`: Boolean indicating if this is a transfer edge

## Implementation Logic

### Data Collection

The graph is built using the TFL Line RouteSequence API, which provides:
- Complete station sequences for each line
- Accurate station coordinates and attributes
- Parent-child station relationships

### Parent-Child Station Relationships

The graph handles complex station relationships like "Bank Underground Station" and "Bank DLR Station" by:
1. Creating separate nodes for each station/entrance
2. Adding zero-weight bidirectional edges between parent and child stations
3. This ensures transfers between these stations take no time in journey calculations

For example, "Canary Wharf Underground Station" is connected to both "Canary Wharf DLR Station" and "Canary Wharf" (Elizabeth Line) with zero-weight edges, making them effectively the same location for travel planning.

### Edge Weights

Edge weights represent travel time between stations:
- Regular edges: Weight of 1 (default, can be updated with actual journey times)
- Transfer edges: Weight of 0 (free transfers between connected stations)

### Station Coverage

The graph includes all stations from the TFL API across supported modes:
- London Underground (tube)
- Docklands Light Railway (dlr)
- London Overground (overground)
- Elizabeth Line

## Usage in the Application

This graph is used to:
1. Find routes between stations
2. Calculate journey times
3. Identify optimal meeting points by minimizing total travel time

## Generation Process

The graph is generated by `build_networkx_graph.py` in the root directory:
1. Fetches line sequence data from TFL API
2. Extracts station data and connections
3. Builds a NetworkX DiGraph
4. Adds zero-weight edges for transfers
5. Exports to JSON format

## Validation

The graph is validated using `test_station_coverage.py` to ensure:
1. All stations from slim_stations/unique_stations.json are included
2. All parent-child station relationships have proper transfer edges
3. No stations are disconnected from the main network

## References

- [TFL API Documentation](https://api-portal.tfl.gov.uk/)
- [NetworkX Documentation](https://networkx.org/documentation/stable/) 